---
phase: 04-reporting-engine
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/reporting/__init__.py, src/reporting/report_builder.py, tests/test_report_builder.py]
autonomous: true
---

<objective>
Design unified report structure and builder that aggregates findings from all analysis modules.

Purpose: Create common report data model that consolidates equipment analysis, seasonal patterns, vendor performance, and failure patterns into structured format ready for PDF/Excel rendering.
Output: ReportBuilder class that collects analysis results and produces standardized report data structure.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries
@.planning/phases/02-equipment-category-analysis/02-03-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-01-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-02-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-03-SUMMARY.md

# Relevant source files
@src/analysis/equipment_ranker.py
@src/analysis/seasonal_analyzer.py
@src/analysis/vendor_analyzer.py
@src/analysis/failure_pattern_analyzer.py

**From Phases 2-3:**
- Equipment ranking with priority scores and thresholds
- Seasonal cost patterns with variance analysis
- Vendor performance metrics and recommendations
- Failure pattern detection with high-impact issues

**Report Requirements:**
- Consolidate all analysis findings into single report
- Include executive summary with key metrics
- Provide detailed sections for each analysis type
- Add actionable recommendations from each module
- Support multiple output formats (PDF, Excel)

**Report Structure:**
1. Executive Summary - high-level metrics and top findings
2. Equipment Analysis - ranked equipment, outliers, thresholds
3. Seasonal Patterns - monthly/quarterly trends, peak periods
4. Vendor Performance - cost analysis, efficiency metrics
5. Failure Patterns - recurring issues, high-impact patterns
6. Recommendations - consolidated actionable items
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create report data model and structure</name>
  <files>src/reporting/report_builder.py</files>
  <action>
Create ReportBuilder class with data model:
- ReportSection class: title, content (DataFrame or dict), summary_text, recommendations
- Report class: metadata (generated_date, data_period, total_records), sections list, executive_summary

Implement ReportBuilder methods:
- __init__(input_file): Stores input file path
- build_report(): Orchestrates full report generation, returns Report object
- _build_executive_summary(all_sections): Aggregates top metrics across sections
- _create_section(title, content, summary, recommendations): Helper to create ReportSection

Report metadata should include:
- Report generation timestamp
- Data period (from min/max dates in data)
- Total work orders analyzed
- Total cost analyzed
- Date range coverage

Use dataclasses or simple classes for Report and ReportSection structures.
Include docstrings with parameter types and return formats.
  </action>
  <verify>Import ReportBuilder, instantiate with test file path, verify class structure</verify>
  <done>ReportBuilder class with Report and ReportSection data models defined</done>
</task>

<task type="auto">
  <name>Task 2: Implement analysis aggregation methods</name>
  <files>src/reporting/report_builder.py</files>
  <action>
Add to ReportBuilder:
- add_equipment_analysis(): Runs equipment_ranker, creates equipment section with top 10 ranked items, thresholds, outlier count
- add_seasonal_analysis(): Runs seasonal_analyzer, creates seasonal section with monthly/quarterly trends, detected patterns
- add_vendor_analysis(): Runs vendor_analyzer, creates vendor section with top/bottom vendors, efficiency metrics, recommendations
- add_failure_analysis(): Runs failure_pattern_analyzer, creates failure section with high-impact patterns, categorized failures

Each method:
1. Runs corresponding analyzer on loaded data
2. Extracts key findings (top N items, patterns, recommendations)
3. Creates ReportSection with findings
4. Returns ReportSection for inclusion in report

Handle edge cases:
- No outliers found (equipment analysis)
- Insufficient data for patterns (seasonal)
- Missing vendor data
- No failure text available

Format numbers: currency with $ and commas, percentages to 1 decimal, dates as YYYY-MM-DD.
  </action>
  <verify>Call each add_* method, verify ReportSection objects returned with proper data</verify>
  <done>All four analysis aggregation methods working, returning structured sections</done>
</task>

<task type="auto">
  <name>Task 3: Create comprehensive test suite</name>
  <files>tests/test_report_builder.py</files>
  <action>
Create test suite with pytest covering:
- Report and ReportSection data model creation
- ReportBuilder initialization with valid/invalid file paths
- Executive summary generation with multi-section data
- Equipment analysis section with known ranked data
- Seasonal analysis section with detected patterns
- Vendor analysis section with performance metrics
- Failure analysis section with high-impact patterns
- Full report build with all sections
- Edge cases: empty sections, missing data fields, no patterns found

Use sample data from existing analyzer tests.
Mock analyzer outputs for predictable testing.
Verify section structure, content presence, recommendation formatting.
  </action>
  <verify>pytest tests/test_report_builder.py passes all tests</verify>
  <done>15+ tests covering report building and all analysis sections, all passing</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pytest tests/test_report_builder.py passes
- [ ] ReportBuilder can aggregate all four analysis types
- [ ] Report structure contains all expected sections
- [ ] Executive summary includes key metrics from all analyses
- [ ] Recommendations are properly formatted and actionable
- [ ] No import errors or type issues
</verification>

<success_criteria>

- All tasks completed
- All tests pass
- ReportBuilder class fully functional
- Report data model supports PDF and Excel rendering
- All analysis modules integrated successfully
  </success_criteria>

<output>
After completion, create `.planning/phases/04-reporting-engine/04-01-SUMMARY.md`
</output>
