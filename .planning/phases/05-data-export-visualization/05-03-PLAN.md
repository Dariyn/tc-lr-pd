---
phase: 05-data-export-visualization
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified: [src/visualization/dashboard_generator.py, tests/test_dashboard_generator.py, requirements.txt]
autonomous: true
---

<objective>
Create interactive HTML dashboard with explorable charts for stakeholder analysis.

Purpose: Enable stakeholders to interact with analysis findings through web-based visualizations. Dashboards allow filtering, zooming, hovering for details, and exporting images - providing deeper insights than static reports.

Output: DashboardGenerator class that creates self-contained HTML files with interactive plotly charts, leveraging data exports from plan 05-01.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Dependencies - we use the data export methods
@.planning/phases/05-data-export-visualization/05-01-SUMMARY.md

# Phase dependencies - what data we're visualizing
@.planning/phases/02-equipment-category-analysis/02-03-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-01-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-02-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-03-SUMMARY.md

# Source code
@src/exports/data_exporter.py
@src/analysis/equipment_ranker.py
@src/analysis/seasonal_analyzer.py
@src/analysis/vendor_analyzer.py
@src/analysis/failure_pattern_analyzer.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up plotly and create interactive equipment ranking chart</name>
  <files>requirements.txt, src/visualization/dashboard_generator.py</files>
  <action>
Add plotly==5.18.0 to requirements.txt (best library for interactive HTML dashboards, self-contained output, no server required).

Create DashboardGenerator class in src/visualization/dashboard_generator.py:
- __init__(self): Initialize plotly configuration
- _create_equipment_chart(df, top_n=20) -> plotly.graph_objects.Figure:
  * Interactive horizontal bar chart of equipment by priority_score
  * Hover shows: equipment_id, category, work_orders, total_cost, avg_cost, priority_score
  * Color bars by category with discrete color map
  * X-axis: priority score, Y-axis: equipment names
  * Clickable legend to filter by category
  * Title: "Equipment Maintenance Priority Rankings"
  * Return plotly Figure object

Use plotly.graph_objects for precise control. Configure hover template with custom formatting (currency for costs, 2 decimals for scores). Set height=max(400, top_n * 30) for dynamic sizing. Use plotly's default theme for professional appearance.
  </action>
  <verify>pytest tests/test_dashboard_generator.py -v -k equipment</verify>
  <done>plotly added, DashboardGenerator created, interactive equipment chart method returns valid plotly Figure</done>
</task>

<task type="auto">
  <name>Task 2: Add interactive seasonal, vendor, and failure charts</name>
  <files>src/visualization/dashboard_generator.py</files>
  <action>
Add chart methods to DashboardGenerator:

_create_seasonal_chart(patterns_dict) -> plotly.graph_objects.Figure:
- Interactive line chart with dual Y-axes
- Primary Y: total_cost (blue line with markers)
- Secondary Y: work_order_count (orange line with markers)
- X-axis: months (categorical)
- Hover shows: month, total_cost ($), work_order_count, avg_cost ($)
- Range slider for time navigation
- Title: "Seasonal Cost and Work Order Trends"
- Toggleable traces (click legend to show/hide)

_create_vendor_chart(df, top_n=15) -> plotly.graph_objects.Figure:
- Interactive grouped bar chart
- Groups: top N vendors by total_cost
- Bars: total_cost, avg_cost, cost_efficiency (3 bars per vendor)
- Hover shows: vendor name, metric value, work_order_count, avg_duration
- Clickable legend to toggle metrics
- X-axis: vendor names, Y-axis: cost ($)
- Title: "Vendor Performance Comparison"

_create_failure_chart(patterns_list, top_n=15) -> plotly.graph_objects.Figure:
- Interactive horizontal bar chart
- Y-axis: pattern phrases, X-axis: impact_score
- Color by category (leak, electrical, mechanical, other)
- Hover shows: pattern, frequency, total_cost, equipment_count, category
- Clickable legend to filter by category
- Title: "High-Impact Failure Patterns"

All charts should use consistent styling: plotly default template, hover mode 'closest', show legend, enable modebar (zoom, pan, reset, export to PNG).
  </action>
  <verify>pytest tests/test_dashboard_generator.py -v -k "seasonal or vendor or failure"</verify>
  <done>Three interactive chart methods implemented, all return valid plotly Figures with hover data and interactivity</done>
</task>

<task type="auto">
  <name>Task 3: Create dashboard assembly and comprehensive tests</name>
  <files>src/visualization/dashboard_generator.py, tests/test_dashboard_generator.py</files>
  <action>
Add to DashboardGenerator:

create_dashboard(equipment_df, seasonal_dict, vendor_df, patterns_list, output_path, title="Work Order Analysis Dashboard"):
- Create HTML dashboard with all 4 charts in 2x2 grid layout
- Use plotly.subplots with make_subplots(rows=2, cols=2, subplot_titles=[...])
- Top left: Equipment rankings, Top right: Seasonal trends
- Bottom left: Vendor performance, Bottom right: Failure patterns
- Add overall title and timestamp
- Configure layout: height=1200, responsive sizing, shared hover mode
- Write to output_path as standalone HTML (include plotly.js, no CDN dependency)
- Return output_path on success

Use plotly.offline.plot() with auto_open=False and output_type='file' for self-contained HTML. Add metadata in HTML comment: generation timestamp, data summary (row counts).

Create comprehensive test suite (tests/test_dashboard_generator.py):

Individual chart tests (8 tests):
- test_equipment_chart: Verify Figure object, data traces, layout
- test_equipment_chart_hover: Verify hover template includes all fields
- test_seasonal_chart: Verify dual Y-axes, line traces
- test_seasonal_range_slider: Verify slider configuration
- test_vendor_chart: Verify grouped bars, legend
- test_failure_chart: Verify categories, colors
- test_chart_empty_data: All methods handle empty data
- test_chart_return_type: All methods return plotly Figure

Dashboard generation tests (6 tests):
- test_create_dashboard: Verify HTML file created
- test_dashboard_html_valid: Parse HTML, verify structure
- test_dashboard_includes_all_charts: Verify 4 subplot regions
- test_dashboard_standalone: Verify plotly.js embedded (no CDN)
- test_dashboard_metadata: Verify timestamp comment
- test_dashboard_responsive: Verify layout config for responsive design

Use pytest fixtures for sample data. Use tmp_path for output. Verify HTML validity with basic parsing (check for <!DOCTYPE html>, <script>, chart divs). Test file size > 500KB (embedded plotly.js is large).
  </action>
  <verify>pytest tests/test_dashboard_generator.py -v --cov=src/visualization/dashboard_generator</verify>
  <done>Dashboard assembly method implemented, 14+ tests covering all functionality, all tests pass with >90% coverage, HTML dashboards are self-contained and interactive</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pytest tests/test_dashboard_generator.py passes all tests
- [ ] Dashboard HTML file is self-contained (includes plotly.js)
- [ ] All 4 charts render and are interactive (hover, zoom, filter)
- [ ] Edge cases handled (empty data, missing fields)
- [ ] Generated HTML opens in browser and works offline
</verification>

<success_criteria>

- All tasks completed
- DashboardGenerator creates interactive HTML dashboards with 4 charts
- Charts support hover, zoom, pan, legend filtering, and PNG export
- Self-contained HTML files work offline (no CDN dependencies)
- Comprehensive test suite with 14+ tests passing
- No errors or warnings introduced
  </success_criteria>

<output>
After completion, create `.planning/phases/05-data-export-visualization/05-03-SUMMARY.md`
</output>
