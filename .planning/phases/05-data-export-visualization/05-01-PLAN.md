---
phase: 05-data-export-visualization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/exports/__init__.py, src/exports/data_exporter.py, tests/test_data_exporter.py]
autonomous: true
---

<objective>
Create structured CSV and JSON export functionality for all analysis findings.

Purpose: Enable stakeholders to consume analysis data in standard formats for external tools, spreadsheets, or custom processing. Provides programmatic access to ranked equipment lists, seasonal patterns, vendor metrics, and failure patterns.

Output: DataExporter class with methods to export each analysis type to CSV and JSON formats with proper structure and formatting.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase dependencies - what data we're exporting
@.planning/phases/02-equipment-category-analysis/02-03-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-01-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-02-SUMMARY.md
@.planning/phases/03-cost-pattern-analysis/03-03-SUMMARY.md
@.planning/phases/04-reporting-engine/04-01-SUMMARY.md

# Source code to understand data structures
@src/reporting/report_builder.py
@src/analysis/equipment_ranker.py
@src/analysis/seasonal_analyzer.py
@src/analysis/vendor_analyzer.py
@src/analysis/failure_pattern_analyzer.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DataExporter class with CSV export methods</name>
  <files>src/exports/__init__.py, src/exports/data_exporter.py</files>
  <action>
Create src/exports/ directory and DataExporter class with methods:
- export_equipment_rankings(df, output_path): Export equipment ranking DataFrame to CSV with proper column headers, sorting by priority_score descending
- export_seasonal_patterns(patterns_dict, output_path): Export seasonal analysis to CSV with columns: month, total_cost, work_order_count, avg_cost
- export_vendor_metrics(df, output_path): Export vendor performance DataFrame to CSV sorted by total_cost descending
- export_failure_patterns(patterns_list, output_path): Export failure patterns to CSV with columns: pattern, frequency, total_cost, equipment_count, category

Use pandas.to_csv() with index=False for clean output. Handle edge cases: empty DataFrames, missing columns, None values. Each export method should accept the data structure from the corresponding analyzer and convert to a clean CSV format.

Export __init__.py: from .data_exporter import DataExporter
  </action>
  <verify>pytest tests/test_data_exporter.py -v -k csv</verify>
  <done>All CSV export methods implemented, handle edge cases gracefully, output clean CSVs with proper headers</done>
</task>

<task type="auto">
  <name>Task 2: Add JSON export methods to DataExporter</name>
  <files>src/exports/data_exporter.py</files>
  <action>
Add JSON export methods to DataExporter class:
- export_equipment_rankings_json(df, output_path): Convert DataFrame to list of dicts, sort by priority_score, write as pretty-printed JSON with indent=2
- export_seasonal_patterns_json(patterns_dict, output_path): Write seasonal patterns dict directly to JSON with proper structure
- export_vendor_metrics_json(df, output_path): Convert vendor DataFrame to list of dicts sorted by total_cost, write as JSON
- export_failure_patterns_json(patterns_list, output_path): Write patterns list to JSON with structure preserving all fields

Use json.dump() with indent=2 for readable output. Convert pandas DataFrames using df.to_dict('records'). Handle NaN/Infinity values (replace with null). Ensure dates are serialized as ISO strings. Each JSON should be valid and pretty-printed for human readability.
  </action>
  <verify>pytest tests/test_data_exporter.py -v -k json</verify>
  <done>All JSON export methods implemented, output valid pretty-printed JSON, handle special values (NaN, dates)</done>
</task>

<task type="auto">
  <name>Task 3: Create comprehensive test suite for data exports</name>
  <files>tests/test_data_exporter.py</files>
  <action>
Create comprehensive test suite covering:

CSV export tests (10 tests):
- test_export_equipment_rankings_csv: Verify CSV structure, headers, sorting
- test_export_seasonal_patterns_csv: Verify monthly data format
- test_export_vendor_metrics_csv: Verify vendor data structure
- test_export_failure_patterns_csv: Verify pattern data
- test_csv_empty_dataframe: Handle empty data gracefully
- test_csv_missing_columns: Handle incomplete data
- test_csv_special_characters: Handle equipment names with commas, quotes
- test_csv_file_creation: Verify files created at correct paths
- test_csv_roundtrip: Read exported CSV and verify data integrity
- test_csv_no_index: Verify index=False in output

JSON export tests (10 tests):
- test_export_equipment_rankings_json: Verify JSON structure and sorting
- test_export_seasonal_patterns_json: Verify monthly structure
- test_export_vendor_metrics_json: Verify vendor structure
- test_export_failure_patterns_json: Verify pattern structure
- test_json_empty_data: Handle empty data
- test_json_nan_values: NaN converted to null
- test_json_date_serialization: Dates as ISO strings
- test_json_pretty_print: Verify indent=2 formatting
- test_json_valid_parse: Verify parseable JSON
- test_json_roundtrip: Load and verify data integrity

Use pytest fixtures for sample data (equipment DataFrame, seasonal dict, vendor DataFrame, patterns list). Use tmp_path fixture for output files. Verify both file existence and content correctness.
  </action>
  <verify>pytest tests/test_data_exporter.py -v --cov=src/exports</verify>
  <done>20+ tests covering all export methods, edge cases, file I/O, and data integrity. All tests pass with >95% coverage.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pytest tests/test_data_exporter.py passes all tests
- [ ] Both CSV and JSON exports work for all analysis types
- [ ] Edge cases handled (empty data, missing columns, special characters)
- [ ] Output files are clean, well-formatted, and valid
</verification>

<success_criteria>

- All tasks completed
- DataExporter class supports CSV and JSON export for all 4 analysis types
- Comprehensive test suite with 20+ tests passing
- No errors or warnings introduced
- Exports produce clean, valid files ready for external consumption
  </success_criteria>

<output>
After completion, create `.planning/phases/05-data-export-visualization/05-01-SUMMARY.md`
</output>
